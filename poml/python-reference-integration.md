Title: Integration - POML Documentation

URL Source: http://microsoft.github.io/poml/stable/python/reference/integration

Published Time: Sat, 20 Sep 2025 06:54:30 GMT

Markdown Content:
Integration - POML Documentation

===============
- [x] - [x] 

[Skip to content](https://microsoft.github.io/poml/stable/python/reference/integration/#poml-integrations)

[![Image 1: logo](https://microsoft.github.io/poml/stable/media/logo-64-white.png)](https://microsoft.github.io/poml/stable/ "POML Documentation")

 POML Documentation 

0.0.8
*   [latest](https://microsoft.github.io/poml/latest/)
*   [0.0.8](https://microsoft.github.io/poml/0.0.8/)

 Integration 

Type to start searching

[microsoft/poml * 4.8k * 251](https://github.com/microsoft/poml "Go to repository")

[![Image 2: logo](https://microsoft.github.io/poml/stable/media/logo-64-white.png)](https://microsoft.github.io/poml/stable/ "POML Documentation") POML Documentation  

[microsoft/poml * 4.8k * 251](https://github.com/microsoft/poml "Go to repository")

*   [Getting Started](https://microsoft.github.io/poml/stable/)
*   - [x]  Tutorial   Tutorial  
    *   [Quick Start](https://microsoft.github.io/poml/stable/tutorial/quickstart/)
    *   - [x]  Travel Expense Agent   Travel Expense Agent  
        *   [Part 1 - Build Workflow](https://microsoft.github.io/poml/stable/tutorial/expense_part1/)
        *   [Part 2 - Debug with VS Code Extension](https://microsoft.github.io/poml/stable/tutorial/expense_part2/)

*   - [x]  Language Spec   Language Spec  
    *   [Basic Syntax](https://microsoft.github.io/poml/stable/language/basic/)
    *   [Template Engine](https://microsoft.github.io/poml/stable/language/template/)
    *   [Meta](https://microsoft.github.io/poml/stable/language/meta/)
    *   - [x]  Fine-grained Control   Fine-grained Control  
        *   [White Space Control](https://microsoft.github.io/poml/stable/language/white-space/)
        *   [Token Control](https://microsoft.github.io/poml/stable/language/token/)

    *   - [x]  References   References  
        *   [Components](https://microsoft.github.io/poml/stable/language/components/)

*   - [x]  Visual Studio Code   Visual Studio Code  
    *   [Overview](https://microsoft.github.io/poml/stable/vscode/)
    *   [Features](https://microsoft.github.io/poml/stable/vscode/features/)
    *   [Configuration](https://microsoft.github.io/poml/stable/vscode/configuration/)

*   - [x]  Python   Python  
    *   [Overview](https://microsoft.github.io/poml/stable/python/)
    *   [Tracing](https://microsoft.github.io/poml/stable/python/trace/)
    *   - [x]  Integrations   Integrations  
        *   [OpenAI](https://microsoft.github.io/poml/stable/python/integration/openai/)
        *   [LangChain](https://microsoft.github.io/poml/stable/python/integration/langchain/)
        *   [MCP](https://microsoft.github.io/poml/stable/python/integration/mcp/)
        *   [MLflow](https://microsoft.github.io/poml/stable/python/integration/mlflow/)
        *   [AgentOps](https://microsoft.github.io/poml/stable/python/integration/agentops/)
        *   [Weave](https://microsoft.github.io/poml/stable/python/integration/weave/)

    *   - [x]  References   References  
        *   [Core](https://microsoft.github.io/poml/stable/python/reference/core/)
        *   - [x]  Integration  [Integration](https://microsoft.github.io/poml/stable/python/reference/integration/) Table of contents  
            *   [agentops](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops)
                *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops.log_poml_call)

            *   [langchain](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain)
                *   [LangchainPomlTemplate](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain.LangchainPomlTemplate)

            *   [mlflow](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow)
                *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow.log_poml_call)

            *   [pydantic](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic)
                *   [NotGiven](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.NotGiven)
                *   [is_dataclass_like_type](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.is_dataclass_like_type)
                *   [to_strict_json_schema](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.to_strict_json_schema)

            *   [weave](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave)
                *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave.log_poml_call)

        *   [Prompt](https://microsoft.github.io/poml/stable/python/reference/prompt/)

*   - [x]  TypeScript   TypeScript  
    *   [Overview](https://microsoft.github.io/poml/stable/typescript/)
    *   - [x]  References   References  
        *   [index](https://microsoft.github.io/poml/stable/typescript/reference/)
        *   [base](https://microsoft.github.io/poml/stable/typescript/reference/base/)
        *   [cli](https://microsoft.github.io/poml/stable/typescript/reference/cli/)
        *   [essentials](https://microsoft.github.io/poml/stable/typescript/reference/essentials/)
        *   [file](https://microsoft.github.io/poml/stable/typescript/reference/file/)
        *   [writer](https://microsoft.github.io/poml/stable/typescript/reference/writer/)
        *   [components](https://microsoft.github.io/poml/stable/typescript/reference/components/)

*   - [x]  Deep Dive   Deep Dive  
    *   [IR Specification](https://microsoft.github.io/poml/stable/deep-dive/ir/)
    *   - [x]  Proposals   Proposals  
        *   [Extended POML](https://microsoft.github.io/poml/stable/deep-dive/proposals/poml_extended/)

 Table of contents  
*   [agentops](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops)
    *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops.log_poml_call)

*   [langchain](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain)
    *   [LangchainPomlTemplate](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain.LangchainPomlTemplate " LangchainPomlTemplate")

*   [mlflow](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow)
    *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow.log_poml_call)

*   [pydantic](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic)
    *   [NotGiven](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.NotGiven)
    *   [is_dataclass_like_type](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.is_dataclass_like_type)
    *   [to_strict_json_schema](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.to_strict_json_schema)

*   [weave](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave)
    *   [log_poml_call](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave.log_poml_call)

POML Integrations[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml-integrations "Permanent link")
==============================================================================================================================

_Estimated time to read: 1 minute_

`poml.integration.agentops`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops "Permanent link")
------------------------------------------------------------------------------------------------------------------------------------------------

### ```python
log_poml_call(name, prompt, context, stylesheet, result)
```
[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.agentops.log_poml_call "Permanent link")

Log the entire poml call to agentops.

Source code in `python/poml/integration/agentops.py`

[7](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-7)
[8](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-8)
[9](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-9)
[10](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-10)
[11](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-11)
[12](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-12)
[13](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-13)
[14](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-14)```
def log_poml_call(name: str, prompt: str, context: dict | None, stylesheet: dict | None, result: Any) -> Any:
    """Log the entire poml call to agentops."""

    @agentops.operation(name="poml")
    def poml(prompt, context, stylesheet):
        return result

    poml(prompt, context, stylesheet)
```

`poml.integration.langchain`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain "Permanent link")
--------------------------------------------------------------------------------------------------------------------------------------------------

### `LangchainPomlTemplate`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.langchain.LangchainPomlTemplate "Permanent link")

Bases: `PromptTemplate`

A LangChain-compatible prompt template that uses POML (Prompt Markup Language) for formatting.

This class extends LangChain's PromptTemplate to support POML markup, enabling rich prompt formatting with speaker modes and structured content. It can load templates from files or strings and format them into either ChatPromptValue or StringPromptValue objects.

Attributes:

| Name | Type | Description |
| --- | --- | --- |
| `template_file` | `Union[str, Path, None]` | Path to the POML template file, if loaded from file. |
| `speaker_mode` | `bool` | Whether to format output as chat messages (True) or plain text (False). Defaults to True. |

Examples:

Create from a template string:

```
>>> template = LangchainPomlTemplate.from_template(
...     "Hello {{name}}!", speaker_mode=True
... )
>>> result = template.format(name="Alice")
```

Load from a POML file:

```
>>> template = LangchainPomlTemplate.from_file(
...     "path/to/template.poml", speaker_mode=False
... )
>>> result = template.format(user_input="What is AI?")
```

Note
*   In speaker_mode=True, returns ChatPromptValue with structured messages
*   In speaker_mode=False, returns StringPromptValue with plain text
*   The from_examples() method is not supported and will raise NotImplementedError

Source code in `python/poml/integration/langchain.py`

[15](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-15)
[16](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-16)
[17](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-17)
[18](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-18)
[19](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-19)
[20](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-20)
[21](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-21)
[22](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-22)
[23](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-23)
[24](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-24)
[25](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-25)
[26](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-26)
[27](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-27)
[28](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-28)
[29](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-29)
[30](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-30)
[31](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-31)
[32](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-32)
[33](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-33)
[34](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-34)
[35](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-35)
[36](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-36)
[37](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-37)
[38](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-38)
[39](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-39)
[40](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-40)
[41](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-41)
[42](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-42)
[43](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-43)
[44](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-44)
[45](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-45)
[46](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-46)
[47](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-47)
[48](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-48)
[49](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-49)
[50](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-50)
[51](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-51)
[52](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-52)
[53](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-53)
[54](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-54)
[55](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-55)
[56](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-56)
[57](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-57)
[58](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-58)
[59](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-59)
[60](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-60)
[61](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-61)
[62](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-62)
[63](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-63)
[64](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-64)
[65](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-65)
[66](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-66)
[67](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-67)
[68](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-68)
[69](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-69)
[70](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-70)
[71](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-71)
[72](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-72)
[73](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-73)
[74](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-74)
[75](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-75)
[76](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-76)
[77](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-77)
[78](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-78)
[79](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-79)
[80](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-80)
[81](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-81)
[82](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-82)
[83](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-83)
[84](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-84)
[85](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-85)
[86](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-86)
[87](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-87)
[88](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-88)
[89](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-89)
[90](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-90)
[91](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-91)
[92](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-92)
[93](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-93)
[94](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-94)
[95](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-95)
[96](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-96)
[97](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-97)
[98](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-98)
[99](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-99)
[100](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-100)
[101](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-101)
[102](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-102)
[103](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-103)
[104](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-104)
[105](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-105)
[106](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-106)
[107](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-107)
[108](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-108)
[109](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-109)
[110](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-110)
[111](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-111)
[112](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-112)
[113](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-113)
[114](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-114)
[115](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-115)
[116](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-116)
[117](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-117)
[118](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-118)
[119](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-119)```
class LangchainPomlTemplate(PromptTemplate):
    """A LangChain-compatible prompt template that uses POML (Prompt Markup Language) for formatting.

    This class extends LangChain's PromptTemplate to support POML markup, enabling rich prompt
    formatting with speaker modes and structured content. It can load templates from files or
    strings and format them into either ChatPromptValue or StringPromptValue objects.

    Attributes:
        template_file (Union[str, Path, None]): Path to the POML template file, if loaded from file.
        speaker_mode (bool): Whether to format output as chat messages (True) or plain text (False).
            Defaults to True.

    Examples:
        Create from a template string:
        >>> template = LangchainPomlTemplate.from_template(
        ...     "Hello {{name}}!", speaker_mode=True
        ... )
        >>> result = template.format(name="Alice")

        Load from a POML file:
        >>> template = LangchainPomlTemplate.from_file(
        ...     "path/to/template.poml", speaker_mode=False
        ... )
        >>> result = template.format(user_input="What is AI?")

    Note:
        - In speaker_mode=True, returns ChatPromptValue with structured messages
        - In speaker_mode=False, returns StringPromptValue with plain text
        - The from_examples() method is not supported and will raise NotImplementedError
    """

    template_file: Union[str, Path, None] = None
    speaker_mode: bool = True

    @property
    @override
    def lc_attributes(self) -> dict[str, Any]:
        return {
            "template_file": self.template_file,
            "speaker_mode": self.speaker_mode,
            # Template format is not used
            # "template_format": self.template_format,
        }

    @classmethod
    @override
    def get_lc_namespace(cls) -> list[str]:
        return ["poml", "integration", "langchain"]

    @classmethod
    def from_examples(cls, *args, **kwargs):
        raise NotImplementedError(
            "LangchainPomlTemplate does not support from_examples. Use from_template or from_file instead."
        )

    @classmethod
    def from_file(
        cls, template_file: Union[str, Path], *args, speaker_mode: bool = True, **kwargs
    ) -> "LangchainPomlTemplate":
        instance: LangchainPomlTemplate = super().from_file(template_file, **kwargs)  # type: ignore
        instance.template_file = template_file
        instance.speaker_mode = speaker_mode
        return instance

    @classmethod
    def from_template(cls, *args, speaker_mode: bool = True, **kwargs) -> "LangchainPomlTemplate":
        instance: LangchainPomlTemplate = super().from_template(*args, **kwargs)  # type: ignore
        instance.speaker_mode = speaker_mode
        return instance

    def format(self, **kwargs) -> Union[ChatPromptValue, StringPromptValue]:  # type: ignore
        kwargs = self._merge_partial_and_user_variables(**kwargs)
        if self.template_file:
            formatted_messages = poml_formatter(self.template_file, self.speaker_mode, kwargs)
        else:
            formatted_messages = poml_formatter(self.template, self.speaker_mode, kwargs)
        if self.speaker_mode:
            return ChatPromptValue(messages=formatted_messages)
        else:
            if len(formatted_messages) == 1:
                if isinstance(formatted_messages[0].content, str):
                    return StringPromptValue(text=formatted_messages[0].content)
                elif isinstance(formatted_messages[0].content, list):
                    # If the content is a list, we assume it's a single message with multiple parts.
                    if len(formatted_messages[0].content) == 1:
                        # If there's only one part, return it as a StringPromptValue
                        if isinstance(formatted_messages[0].content[0], str):
                            return StringPromptValue(text=formatted_messages[0].content[0])
                        else:
                            raise ValueError(
                                f"Unsupported content type for non-speaker mode: {formatted_messages[0].content[0]}"
                            )
                    else:
                        raise ValueError(
                            f"Multi-part contents is not supported for non-speaker mode: {formatted_messages[0].content}"
                        )
                else:
                    raise ValueError(f"Unsupported content type for non-speaker mode: {formatted_messages[0].content}")
            else:
                raise ValueError(
                    f"Multiple messages returned, but non-speaker mode requires a single message: {formatted_messages}"
                )

    def format_prompt(self, **kwargs):
        return self.format(**kwargs)
```

`poml.integration.mlflow`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow "Permanent link")
--------------------------------------------------------------------------------------------------------------------------------------------

### ```python
log_poml_call(name, prompt, context, stylesheet, result)
```
[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.mlflow.log_poml_call "Permanent link")

Log the entire poml call to mlflow.

Source code in `python/poml/integration/mlflow.py`

[8](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-8)
[9](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-9)
[10](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-10)
[11](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-11)
[12](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-12)
[13](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-13)
[14](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-14)
[15](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-15)
[16](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-16)
[17](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-17)
[18](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-18)
[19](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-19)
[20](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-20)
[21](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-21)
[22](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-22)
[23](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-23)
[24](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-24)```
def log_poml_call(name: str, prompt: str, context: dict | None, stylesheet: dict | None, result: Any) -> Any:
    """Log the entire poml call to mlflow."""

    @mlflow.trace
    def poml(prompt, context, stylesheet):
        return result

    prompt_registered = mlflow.genai.register_prompt(
        name=name,
        template=prompt,
        tags={
            "format": "poml",
            "source": "auto"
        },
    )

    poml(prompt, context, stylesheet)
```

`poml.integration.pydantic`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic "Permanent link")
------------------------------------------------------------------------------------------------------------------------------------------------

### `NotGiven`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.NotGiven "Permanent link")

A sentinel singleton class used to distinguish omitted keyword arguments from those passed in with the value None (which may have different behavior).

Source code in `python/poml/integration/pydantic.py`

[62](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-62)
[63](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-63)
[64](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-64)
[65](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-65)
[66](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-66)
[67](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-67)
[68](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-68)
[69](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-69)
[70](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-70)
[71](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-71)
[72](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-72)
[73](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-73)```
class NotGiven:
    """
    A sentinel singleton class used to distinguish omitted keyword arguments
    from those passed in with the value None (which may have different behavior).
    """

    def __bool__(self) -> Literal[False]:
        return False

    @override
    def __repr__(self) -> str:
        return "NOT_GIVEN"
```

### ```python
is_dataclass_like_type(typ)
```
[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.is_dataclass_like_type "Permanent link")

Returns True if the given type likely used `@pydantic.dataclass`

Source code in `python/poml/integration/pydantic.py`

[190](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-190)
[191](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-191)
[192](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-192)```
def is_dataclass_like_type(typ: type) -> bool:
    """Returns True if the given type likely used `@pydantic.dataclass`"""
    return hasattr(typ, "__pydantic_config__")
```

### ```python
to_strict_json_schema(model)
```
[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.pydantic.to_strict_json_schema "Permanent link")

Convert a Pydantic model to a strict JSON schema suitable for OpenAI function calling and response format.

This function takes a Pydantic BaseModel class or TypeAdapter and converts it to a JSON schema that conforms to the strict schema requirements for OpenAI's function calling API. The resulting schema ensures all objects have `additionalProperties: false` and all properties are required.

Most of the implementation is adapted from [OpenAI Python SDK](https://github.com/openai/openai-python/blob/4e28a424e6afd60040e3bdf7c76eebb63bc0c407/src/openai/lib/_pydantic.py).

Parameters:

| Name | Type | Description | Default |
| --- | --- | --- | --- |
| `model` | `type[BaseModel] | TypeAdapter[Any]` | A Pydantic BaseModel class or TypeAdapter instance to convert to JSON schema | _required_ |

Returns:

| Type | Description |
| --- | --- |
| `dict[str, Any]` | A dictionary representing the strict JSON schema |

Raises:

| Type | Description |
| --- | --- |
| `TypeError` | If the model is not a BaseModel type and Pydantic v2 is not available, or if a non-BaseModel type is used with Pydantic v1 |

Example

```
from pydantic import BaseModel, Field
from poml.integration.pydantic import to_strict_json_schema

class Query(BaseModel):
    name: str = Field(description="Query name")
    limit: int = Field(description="Result limit", default=10)

schema = to_strict_json_schema(Query)
# Returns a strict JSON schema with additionalProperties: false
```

Source code in `python/poml/integration/pydantic.py`

[16](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-16)
[17](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-17)
[18](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-18)
[19](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-19)
[20](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-20)
[21](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-21)
[22](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-22)
[23](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-23)
[24](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-24)
[25](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-25)
[26](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-26)
[27](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-27)
[28](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-28)
[29](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-29)
[30](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-30)
[31](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-31)
[32](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-32)
[33](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-33)
[34](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-34)
[35](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-35)
[36](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-36)
[37](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-37)
[38](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-38)
[39](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-39)
[40](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-40)
[41](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-41)
[42](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-42)
[43](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-43)
[44](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-44)
[45](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-45)
[46](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-46)
[47](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-47)
[48](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-48)
[49](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-49)
[50](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-50)
[51](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-51)
[52](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-52)
[53](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-53)
[54](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-54)
[55](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-55)
[56](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-56)
[57](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-57)
[58](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-58)
[59](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-59)```
def to_strict_json_schema(model: type[pydantic.BaseModel] | pydantic.TypeAdapter[Any]) -> dict[str, Any]:
    """
    Convert a Pydantic model to a strict JSON schema suitable for OpenAI function calling and response format.

    This function takes a Pydantic BaseModel class or TypeAdapter and converts it to a JSON schema
    that conforms to the strict schema requirements for OpenAI's function calling API. The resulting
    schema ensures all objects have `additionalProperties: false` and all properties are required.

    Most of the implementation is adapted from [OpenAI Python SDK](https://github.com/openai/openai-python/blob/4e28a424e6afd60040e3bdf7c76eebb63bc0c407/src/openai/lib/_pydantic.py).

    Args:
        model: A Pydantic BaseModel class or TypeAdapter instance to convert to JSON schema

    Returns:
        A dictionary representing the strict JSON schema

    Raises:
        TypeError: If the model is not a BaseModel type and Pydantic v2 is not available,
                  or if a non-BaseModel type is used with Pydantic v1

    Example:
        ```python
        from pydantic import BaseModel, Field
        from poml.integration.pydantic import to_strict_json_schema

        class Query(BaseModel):
            name: str = Field(description="Query name")
            limit: int = Field(description="Result limit", default=10)

        schema = to_strict_json_schema(Query)
        # Returns a strict JSON schema with additionalProperties: false
        ```
    """
    if inspect.isclass(model) and is_basemodel_type(model):
        if PYDANTIC_V2:
            schema = model.model_json_schema()
        else:
            schema = model.schema()  # type: ignore
    elif PYDANTIC_V2 and isinstance(model, pydantic.TypeAdapter):
        schema = model.json_schema()
    else:
        raise TypeError(f"Non BaseModel types are only supported with Pydantic v2 - {model}")

    return _ensure_strict_json_schema(schema, path=(), root=schema)
```

`poml.integration.weave`[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave "Permanent link")
------------------------------------------------------------------------------------------------------------------------------------------

### ```python
log_poml_call(name, prompt, context, stylesheet, result)
```
[¶](https://microsoft.github.io/poml/stable/python/reference/integration/#poml.integration.weave.log_poml_call "Permanent link")

Log the entire poml call to weave.

Source code in `python/poml/integration/weave.py`

[7](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-7)
[8](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-8)
[9](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-9)
[10](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-10)
[11](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-11)
[12](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-12)
[13](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-13)
[14](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-14)
[15](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-15)
[16](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-16)
[17](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-17)
[18](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-18)
[19](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-19)
[20](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-20)
[21](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-21)
[22](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-22)
[23](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-23)
[24](https://microsoft.github.io/poml/stable/python/reference/integration/#__codelineno-0-24)```
def log_poml_call(name: str, prompt: str, context: dict | None, stylesheet: dict | None, result: Any) -> Any:
    """Log the entire poml call to weave."""

    @weave.op
    def poml(prompt, context, stylesheet):
        return result

    prompt_ref = weave.publish(prompt, name=name)
    if context is not None:
        context_ref = weave.publish(context, name=name + ".context")
    else:
        context_ref = context
    if stylesheet is not None and stylesheet != "{}":
        stylesheet_ref = weave.publish(stylesheet, name=name + ".stylesheet")
    else:
        stylesheet_ref = stylesheet

    poml(prompt_ref, context_ref, stylesheet_ref)
```

3 months ago 2025-08-24 3 months ago 2025-08-11[Yuge Zhang](mailto:yuge.zhang@microsoft.com)

 Made with [Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)

